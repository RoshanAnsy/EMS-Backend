// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// generator client {
//   provider = "prisma-client-js"

// }

// datasource db {
//   provider = "postgresql"
//   url      = env("DATABASE_URL")
// }

 
enum Role {
  ADMIN
  DIRECTOR 
  HOS
  AREAMANAGER
  STATEHEAD
  SALESOFFICER
  AREAMANAGEROPS
  ACCOUNTANT
  SITESUPERVISOR
  HR
  CP1
  CP2
  SCP1
  SCP2

}
 
model User {
  id        String   @id @default(uuid())
  name      String  
  email     String   @unique
  EmplyID   String   @unique
  password  String
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  role      Role
  AdharNo String?  
  PanNo    String?
  MobileNo String?
  EmergencyContactNo String?
  PermanentAddress  String?
  CurrentAddress  String?
  isActive  Boolean  @default(true)
  DateOfJoining DateTime?
  

  
  attendance Attendance[] @relation("UserAttendance")
  task  Task[]  @relation("UserTask")
  assignedTasks Task[] @relation("AssignedTasks")  // Add this
  createdTasks  Task[] @relation("CreatedTasks")   // Add this
  // PaymentDetails  Payment[] @relation("UserPayment")
  paymentsReceived Payment[] @relation("PaymentReceiver")  
  paymentsMade    Payment[] @relation("PaymentMaker") 
  BankDetails  BankDetails?
  logs             Log[]
  TargetTasks TargetTask[] @relation("User")
  AssignedTasks TargetTask[] @relation("AssignedTasks")

  UserMaping UserMaping[]@relation("User")
  UserMapingAssignedTo UserMaping[]@relation("Assigner")
  // UserMapingAssignUser  UserMaping[]@relation("AssignedUser")
  UserMapingAssignUser  AssignUserMaping[] @relation("AssignedUser")
}
 


 model Log {
  id        Int         @id @default(autoincrement())
  userId    String
  user      User        @relation(fields: [userId], references: [id])
  action    ActionTypes // "LOGIN" or "LOGOUT"
  ipAddress String?     // optional: track from where user logged in
  device    String?     // optional: track device/browser
  createdAt DateTime    @default(now())
}


enum ActionTypes {
  LOGIN
  LOGOUT
}

model webUserRight {
  id        String   @id @default(uuid())
  AddedBY    String?
  

  Role      Role

  MenuId    String
  isAccessBy String // To specify if access is by Menu or SubMenu
  SubMenuId String
  SubMenu   SubMenu @relation(fields: [SubMenuId], references: [id])

  isAccess  Boolean  @default(false)
  canView   Boolean  @default(false)
  canAdd    Boolean  @default(false)
  canEdit   Boolean  @default(false)
  canDelete Boolean  @default(false)
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt


  @@index([Role])
  @@index([SubMenuId])
  @@index([isAccessBy])
}

model Menu {
  id        String   @id @default(uuid())
  MenuName  String
  Priority  Int  
  Icon      String?

  SubMenus       SubMenu[]  
 

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SubMenu {
  id        String   @id @default(uuid())
  SubMenuName String  
  MenuId    String
  Menu      Menu     @relation(fields: [MenuId], references: [id])

  Priority  Int
  Icon      String?
  Routes    String

  webUserRights webUserRight[]

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}







model BankDetails {
  id        String   @id @default(uuid())
  userId    String   @unique
  bankName  String  
  branch    String  
  IFSCode  String  
  accountNo String  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  user      User     @relation(fields: [userId], references: [id])
}
// New Payment model to track payment details
model Payment {
  id        String   @id @default(uuid())
  // UserId    String 
  // user      User     @relation("UserPayment", fields: [UserId], references: [id])
  FixAmount  Int   // Fixed amount for the bill
  VariableAmount Int   // Variable amount for the bill
  totalAmount Int // Total amount paid (FixAmount + VariableAmount)
  remark    String?
  fileUrl   String?   // For payment proof document
  PaidTo   String   
  paidToUser User @relation("PaymentReceiver", fields: [PaidTo], references: [id])  // Add this relation
  PaidBy   String   
  paidByUser User @relation("PaymentMaker", fields: [PaidBy], references: [id]) 
  Tds  Int?  // TDS amount if applicable
  AnyTax   Int?  // GST amount if applicable
  TravelCost Int? // Travel cost if applicable
  OtherCost  Int? // Any other cost if applicable
  FoodAllowanceCost Int? // Food allowance if applicable
  medicleInsuranceCost Int? // Medical insurance cost if applicable
  PFAmount Int? // PF amount if applicable
  GratuityAmount Int? // Gratuity amount if applicable
  LaultyAmount Int? // Laulaty amount if applicable
  MisleneousAmount Int? // Misclaneous amount if applicable
  paidAt    DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  // status   BillStatus @default(NOT_INITIATED)
  @@index([paidAt])
} 


// Enum for bill statuses
enum BillStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
  NOT_INITIATED
}
 
// model Attendance{
//   id        String   @id @default(uuid())
//   Type      String
//   UserId    String
//   user      User     @relation("UserAttendance", fields: [UserId], references: [id])
//   PunchInAt?   String
//   PunchOutAt?  String
//   status    AttendanceStatus @default(ABSENT)
//   PunchInLocation String?
//   punchOutLocation String?
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt
//   isActive  Boolean  @default(true)
//   @@index([UserId])
// }
 

model Attendance {
  id               String   @id @default(uuid())
  Type             String
  UserId           String
  user             User     @relation("UserAttendance", fields: [UserId], references: [id])
  PunchInAt        String?
  PunchOutAt       String?
  status           AttendanceStatus @default(ABSENT)
  PunchInLocation  String?
  punchOutLocation String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  isActive         Boolean  @default(true)

  @@index([UserId])
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LEAVE
  HOLIDAY
}

model Task {
  id        String   @id @default(uuid())
  UserId    String
  user      User     @relation("UserTask", fields: [UserId], references: [id])
  title     String  
  description String?
  assignedTo String   
  assignee   User     @relation("AssignedTasks", fields: [assignedTo], references: [id])  // Add this
  assignedBy String   
  assigner   User     @relation("CreatedTasks", fields: [assignedBy], references: [id]) 
  // dueDate   DateTime
  TaskStartedAt DateTime?
  TaskCompletedAt DateTime?
  TotalProjectCost Int?
  TotalReceivedAmount Int?
  PerUnitCost  Int?
  TotalUnits   Int?
  TaskBalanceAmount Int?
  remark    String?
  address   String?
  pinCode   String?
  city      String?
  state     String?
  country   String?
  MobileNo  String?
  purpose   String?
  clientName String?
  companyName String?
  status    TaskStatus @default(PENDING) // Enum for task status
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  @@index([assignedTo])
  @@index([assignedBy])
  @@index([status])
  @@index([pinCode])
  @@index([city])
  @@index([state])
}
 
enum TaskStatus {
  PENDING
  INPROGRESS
  COMPLETED
  CANCELLED
}



model TargetTask {
  TargetTaskID        String   @id @default(uuid())
  UserId    String
  user      User     @relation("User", fields: [UserId], references: [id])
  
  assignedTo String   
  assignee   User     @relation("AssignedTasks", fields: [assignedTo], references: [id])  // Add this

  // dueDate   DateTime
  TaskStartedAt DateTime?
  TaskCompletedAt DateTime?
  TotalProjectCost Int?
  TotalAmountTarget Int?
  TotalTarget  Int?
  TotalUnits   Int?
  remark    String?
  
  companyName String?
  TaskType    TaskPeriod @default(MONTHLY) // Enum for task status
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  @@index([assignedTo])
  @@index([TaskType])
  @@index([UserId])
  
}

enum TaskPeriod {
  MONTHLY
  YEARLY
  
}



// model UserMaping {
//   UserMapingAutoID        String   @id @default(uuid())
//   CreatedByID    String
//   CreatedBy      User     @relation("User", fields: [CreatedByID], references: [id])
  
//   AssignedToID String   
//   AssignedTo   User     @relation("Assigner", fields: [AssignedToID], references: [id])  // Add this

//   AssignUserID String   
//   AssignUser   User     @relation("AssignedUser", fields: [AssignUserID], references: [id])  // Add this

  
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt
//   isActive  Boolean  @default(true)

//   @@index([AssignedToID])
//   @@index([AssignUserID])
//   @@index([CreatedByID])
  
// }



model UserMaping {
  UserMapingAutoID String   @id @default(uuid())
  CreatedByID      String
  CreatedBy        User     @relation("User", fields: [CreatedByID], references: [id])

  AssignedToID     String
  AssignedTo       User     @relation("Assigner", fields: [AssignedToID], references: [id])

  AssignUsers      AssignUserMaping[]  @relation("UserMapingToAssignUser")// One-to-many relation

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)

  @@index([AssignedToID])
  @@index([CreatedByID])
}

model AssignUserMaping {
  id            String   @id @default(uuid())
  userMapingId  String
  assignUserId  String
  AssignUser    User     @relation("AssignedUser", fields: [assignUserId], references: [id])
  UserMaping    UserMaping @relation("UserMapingToAssignUser",fields: [userMapingId], references: [UserMapingAutoID])
  // UserMaping    UserMaping @relation("UserMapingToAssignUser", fields: [userMapingId], references: [UserMapingAutoID])
}




model paymentReceipt {
  PaymentReceiptID       String   @id @default(uuid())
  FixAmount              Boolean  @default(false)
  VariableAmount         Boolean  @default(false)
  TotalAmount            Boolean  @default(false)
  Tds                    Boolean  @default(false)
  AnyTax                 Boolean  @default(false)
  TravelCost             Boolean  @default(false)
  OtherCost              Boolean  @default(false)
  FoodAllowanceCost      Boolean  @default(false)
  MedicleInsuranceCost   Boolean  @default(false)
  PFAmount               Boolean  @default(false)
  GratuityAmount         Boolean  @default(false)
  LaultyAmount           Boolean  @default(false)
  MisleneousAmount       Boolean  @default(false)
  updatedAt              DateTime @updatedAt
  isActive               Boolean  @default(true)
  updatedBY  String
}
